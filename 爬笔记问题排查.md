# Mac Books é«˜äº®æå– - é—®é¢˜æ’é™¤æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£è®°å½•äº†åœ¨ä½¿ç”¨ Mac Books é«˜äº®æå–è„šæœ¬è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€åŸå› åˆ†æå’Œè§£å†³æ–¹æ¡ˆï¼Œä¾›å°†æ¥å‚è€ƒã€‚

**æœ€åæ›´æ–°ï¼š** 2025-01-25  
**ç»´æŠ¤è€…ï¼š** Appleç”¨æˆ·

---

## ğŸ”§ é—®é¢˜è®°å½•

### é—®é¢˜ #1ï¼šæ•°æ®åº“ç»“æ„å…¼å®¹æ€§é—®é¢˜

**ğŸ“… æ—¶é—´ï¼š** 2025-01-25  
**ğŸ” é—®é¢˜æè¿°ï¼š**
- è„šæœ¬è¿è¡Œæ—¶å‡ºç° `no such column: ZPUBLISHER` é”™è¯¯
- æ³¨é‡ŠæŸ¥è¯¢æ—¶å‡ºç° `no such column: ZANNOTATIONCOLOR` é”™è¯¯
- å¯¼è‡´æ— æ³•æ­£ç¡®è¯»å–ä¹¦ç±ä¿¡æ¯å’Œé«˜äº®ç¬”è®°

**ğŸ’¡ åŸå› åˆ†æï¼š**
1. **Apple Books æ•°æ®åº“ç‰ˆæœ¬å·®å¼‚**ï¼š
   - ä¸åŒç‰ˆæœ¬çš„ macOS å’Œ Books åº”ç”¨ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ç»“æ„
   - è¾ƒæ–°æˆ–è¾ƒæ—§ç‰ˆæœ¬å¯èƒ½ç¼ºå°‘æŸäº›å­—æ®µ
   - æ•°æ®åº“æ¶æ„éšç³»ç»Ÿæ›´æ–°è€Œå˜åŒ–

2. **ç¡¬ç¼–ç å­—æ®µæŸ¥è¯¢é—®é¢˜**ï¼š
   - åŸå§‹è„šæœ¬å‡è®¾æ‰€æœ‰å­—æ®µéƒ½å­˜åœ¨
   - æ²¡æœ‰åŠ¨æ€æ£€æµ‹æ•°æ®åº“ç»“æ„
   - ç¼ºå°‘å®¹é”™æœºåˆ¶

**âœ… è§£å†³æ–¹æ¡ˆï¼š**

#### 1. åŠ¨æ€æ£€æµ‹æ•°æ®åº“ç»“æ„
```python
# æ£€æŸ¥è¡¨ç»“æ„
cursor.execute("PRAGMA table_info(ZBKLIBRARYASSET)")
columns = [column[1] for column in cursor.fetchall()]

# æ„å»ºåŠ¨æ€æŸ¥è¯¢
base_columns = ['ZASSETID', 'ZTITLE', 'ZAUTHOR']
optional_columns = ['ZGENRE', 'ZPUBLISHER', 'ZPUBLISHDATE', 'ZLASTOPENDATE']

select_columns = base_columns.copy()
for col in optional_columns:
    if col in columns:
        select_columns.append(col)
```

#### 2. æ·»åŠ  NULL å ä½ç¬¦
```python
# ä¸ºä¸å­˜åœ¨çš„åˆ—æ·»åŠ  NULL å ä½ç¬¦
for col in optional_columns:
    if col in columns:
        select_columns.append(col)
    else:
        select_columns.append('NULL as ' + col)
```

#### 3. ä¿®å¤æ•°æ®è§£æ
```python
# åŠ¨æ€è§£æç»“æœï¼Œé€‚åº”ä¸åŒåˆ—æ•°
asset_id = book[0] if len(book) > 0 else None
title = book[1] if len(book) > 1 else "æœªçŸ¥ä¹¦å"
author = book[2] if len(book) > 2 else None
```

**ğŸ“Š æ•ˆæœï¼š**
- âœ… æˆåŠŸå…¼å®¹ä¸åŒç‰ˆæœ¬çš„æ•°æ®åº“
- âœ… æ­£ç¡®è¯»å– 81 æœ¬ä¹¦ç±ä¿¡æ¯
- âœ… æˆåŠŸæå– 3,314 ä¸ªé«˜äº®ç¬”è®°

---

### é—®é¢˜ #2ï¼šä» Books æ‹–å‡ºçš„ EPUB æ–‡ä»¶ä¸åŸç‰ˆä¸åŒ

**ğŸ“… æ—¶é—´ï¼š** 2025-01-25  
**ğŸ” é—®é¢˜æè¿°ï¼š**
- ä» Books åº”ç”¨æ‹–å‡ºçš„ EPUB æ–‡ä»¶ç¼ºå°‘ç« èŠ‚ä¿¡æ¯
- æ–‡ä»¶ç»“æ„ä¸ç½‘é¡µä¸‹è½½çš„åŸç‰ˆ EPUB ä¸åŒ
- å½±å“ç« èŠ‚åˆ‡åˆ†åŠŸèƒ½

**ğŸ’¡ åŸå› åˆ†æï¼š**
1. **Books åº”ç”¨æ–‡ä»¶å¤„ç†**ï¼š
   - Books å¯¼å…¥æ—¶ä¼šå‹ç¼©å’Œé‡æ–°æ‰“åŒ… EPUB
   - å¯èƒ½ç®€åŒ–æˆ–ç§»é™¤æŸäº›å…ƒæ•°æ®
   - äº‘ç«¯åŒæ­¥å¯èƒ½å¯¼è‡´ä¿¡æ¯ä¸¢å¤±

2. **DRM å’Œç‰ˆæƒä¿æŠ¤**ï¼š
   - Apple çš„æ•°å­—ç‰ˆæƒç®¡ç†
   - é˜²æ­¢å®Œæ•´æ–‡ä»¶æå–

3. **æ ¼å¼è½¬æ¢æŸå¤±**ï¼š
   - å†…éƒ¨å­˜å‚¨æ ¼å¼ä¸æ ‡å‡† EPUB ä¸åŒ
   - å¯¼å‡ºæ—¶å¯èƒ½ä¸¢å¤±ç»“æ„ä¿¡æ¯

**âœ… è§£å†³æ–¹æ¡ˆï¼š**

#### æ–¹æ¡ˆä¸€ï¼šç›´æ¥ä» Books æ•°æ®åº“æå–ï¼ˆæ¨èï¼‰
- âœ… ä½¿ç”¨æœ¬è„šæœ¬ç›´æ¥è¯»å– SQLite æ•°æ®åº“
- âœ… è·å¾—æœ€å®Œæ•´çš„é«˜äº®å’Œç¬”è®°ä¿¡æ¯
- âœ… ä¿ç•™æ—¶é—´æˆ³å’Œå…ƒæ•°æ®

#### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨åŸç‰ˆ EPUB æ–‡ä»¶
- ä»åŸå§‹æ¥æºé‡æ–°ä¸‹è½½ EPUB
- ç”¨äºç« èŠ‚åˆ†æå’Œç»“æ„å¤„ç†
- ç»“åˆæ•°æ®åº“æå–çš„é«˜äº®ä¿¡æ¯

#### æ–¹æ¡ˆä¸‰ï¼šæ›¿ä»£å·¥å…·
- BooknoteWorthy (ç½‘é¡µç‰ˆ)
- Note Exporter (Mac åº”ç”¨)
- apple_eater (Python è„šæœ¬)

**ğŸ“Š æ•ˆæœï¼š**
- âœ… æˆåŠŸæå–ã€ŠThe Creative Actã€‹374 ä¸ªé«˜äº®ç¬”è®°
- âœ… ä¿ç•™å®Œæ•´çš„ç¬”è®°å†…å®¹å’Œæ—¶é—´ä¿¡æ¯
- âœ… ç”Ÿæˆæ ¼å¼åŒ–çš„ Markdown æ–‡ä»¶

---

## ğŸ› ï¸ é€šç”¨è§£å†³æ–¹æ³•

### 1. æ•°æ®åº“å…¼å®¹æ€§é—®é¢˜
**ç—‡çŠ¶ï¼š** `no such column` é”™è¯¯
**è§£å†³æ­¥éª¤ï¼š**
1. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
2. ä½¿ç”¨ `PRAGMA table_info()` æ£€æŸ¥è¡¨ç»“æ„
3. åŠ¨æ€æ„å»ºæŸ¥è¯¢è¯­å¥
4. æ·»åŠ å®¹é”™æœºåˆ¶

### 2. æƒé™é—®é¢˜
**ç—‡çŠ¶ï¼š** æ— æ³•è®¿é—®æ•°æ®åº“æ–‡ä»¶
**è§£å†³æ­¥éª¤ï¼š**
1. ç¡®ä¿ Books åº”ç”¨å·²è¿è¡Œ
2. æ£€æŸ¥æ–‡ä»¶æƒé™
3. å°è¯•é‡æ–°å¯åŠ¨ Books åº”ç”¨
4. æ£€æŸ¥ System Integrity Protection (SIP) è®¾ç½®

### 3. ç©ºç»“æœé—®é¢˜
**ç—‡çŠ¶ï¼š** æ‰¾ä¸åˆ°ä¹¦ç±æˆ–é«˜äº®
**è§£å†³æ­¥éª¤ï¼š**
1. ç¡®è®¤å·²åœ¨ Books ä¸­æ·»åŠ é«˜äº®
2. æ£€æŸ¥ iCloud åŒæ­¥çŠ¶æ€
3. å°è¯•æ·»åŠ æµ‹è¯•é«˜äº®
4. é‡å¯ Books åº”ç”¨ç­‰å¾…åŒæ­¥

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æ•°æ®åº“ç»“æ„æ£€æŸ¥
```bash
# æ£€æŸ¥æ•°æ®åº“è¡¨
sqlite3 ~/Library/Containers/com.apple.iBooksX/Data/Documents/BKLibrary/*.sqlite ".tables"

# æ£€æŸ¥è¡¨ç»“æ„
sqlite3 ~/Library/Containers/com.apple.iBooksX/Data/Documents/BKLibrary/*.sqlite ".schema ZBKLIBRARYASSET"
```

### 2. æµ‹è¯•æŸ¥è¯¢
```sql
-- æ£€æŸ¥ä¹¦ç±æ•°é‡
SELECT COUNT(*) FROM ZBKLIBRARYASSET WHERE ZTITLE IS NOT NULL;

-- æ£€æŸ¥é«˜äº®æ•°é‡
SELECT COUNT(*) FROM ZAEANNOTATION WHERE ZANNOTATIONDELETED = 0;
```

### 3. æ—¥å¿—åˆ†æ
```bash
# è¿è¡Œè„šæœ¬å¹¶ä¿å­˜è¯¦ç»†æ—¥å¿—
python3 books_highlights_extractor.py --list > debug.log 2>&1
```

---

## ğŸ“š ç›¸å…³èµ„æº

### æ•°æ®åº“ä½ç½®
```
# Books æ•°æ®åº“
~/Library/Containers/com.apple.iBooksX/Data/Documents/BKLibrary/

# æ³¨é‡Šæ•°æ®åº“  
~/Library/Containers/com.apple.iBooksX/Data/Documents/AEAnnotation/

# å¤‡ç”¨ä½ç½®ï¼ˆæ—§ç‰ˆæœ¬ï¼‰
~/Library/Containers/com.apple.BKAgentService/Data/Documents/iBooks/
```

### æ›¿ä»£å·¥å…·
1. **BooknoteWorthy** - https://oliwang.github.io/BooknoteWorthy/
2. **Note Exporter** - https://github.com/Alexs7zzh/Note-Exporter
3. **apple_eater** - https://github.com/yirogue/apple_eater

### å¤‡ä»½å»ºè®®
```bash
# å¤‡ä»½ Books æ•°æ®
cp -r ~/Library/Containers/com.apple.iBooksX/ ~/Desktop/Books_Backup/
```

---

## ğŸ“ æ·»åŠ æ–°é—®é¢˜

**æ ¼å¼æ¨¡æ¿ï¼š**
```markdown
### é—®é¢˜ #Xï¼šé—®é¢˜æ ‡é¢˜

**ğŸ“… æ—¶é—´ï¼š** YYYY-MM-DD  
**ğŸ” é—®é¢˜æè¿°ï¼š**
- è¯¦ç»†æè¿°é—®é¢˜ç°è±¡
- é”™è¯¯ä¿¡æ¯
- å½±å“èŒƒå›´

**ğŸ’¡ åŸå› åˆ†æï¼š**
1. ä¸»è¦åŸå› 
2. æ¬¡è¦åŸå› 

**âœ… è§£å†³æ–¹æ¡ˆï¼š**
1. æ­¥éª¤ä¸€
2. æ­¥éª¤äºŒ

**ğŸ“Š æ•ˆæœï¼š**
- è§£å†³ç»“æœ
```

---

## ğŸ”„ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| 1.0 | 2025-01-25 | åˆå§‹ç‰ˆæœ¬ï¼Œè®°å½•æ•°æ®åº“å…¼å®¹æ€§é—®é¢˜ |

---

**ğŸ’¡ æç¤ºï¼š** é‡åˆ°æ–°é—®é¢˜æ—¶ï¼Œè¯·æŒ‰ç…§æ¨¡æ¿æ ¼å¼æ·»åŠ åˆ°æœ¬æ–‡æ¡£ï¼Œå¹¶æ›´æ–°ç‰ˆæœ¬å†å²ã€‚ 
